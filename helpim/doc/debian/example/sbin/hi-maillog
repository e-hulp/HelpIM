# needs some variables:
# $chat (chat identifier)
# $issuer (name of the program sending the maillog)

echo "$issuer report about $chat on `date`" > /tmp/hi-maillog
echo "" >> /tmp/hi-maillog
echo "Mysqldump of room-tables:" >> /tmp/hi-maillog

# mysqldump
echo "" >> /tmp/hi-maillog
echo "Mysqldump of room-tables:" >> /tmp/hi-maillog
mysqldump $chat rooms_accesstoken rooms_grouproom rooms_lobbyroom \
 rooms_lobbyroomtoken rooms_one2oneroom rooms_one2oneroomtoken \
 rooms_waitingroom rooms_waitingroomtoken >> /tmp/hi-maillog

# mail bot-log
echo "" >> /tmp/hi-maillog
echo "Last 250 lines of /var/log/helpim/$chat.log:" >> /tmp/hi-maillog
tail -n 250 /var/log/helpim/$chat.log >> /tmp/hi-maillog

# mail prosody.log
echo "" >> /tmp/hi-maillog
echo "Last 70 lines of /var/log/prosody/prosody.log:" >> /tmp/hi-maillog
tail -n 70 /var/log/prosody/prosody.log >> /tmp/hi-maillog        

# mail prosody.err
echo "" >> /tmp/hi-maillog
echo "Last 20 lines of /var/log/prosody/prosody.err:" >> /tmp/hi-maillog
tail -n 20 /var/log/prosody/prosody.err >> /tmp/hi-maillog

cat /tmp/hi-maillog | mail -s "$issuer log on $chat" helpdesk@e-hulp.nl
